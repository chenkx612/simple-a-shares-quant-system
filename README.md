# Simple A-Shares Quant System

个人量化投资项目，基于 Python 实现的动量轮动策略量化系统。本项目包含**止损轮动**与**行业轮动**两套核心策略，旨在不同市场环境下捕捉收益并控制回撤。

## 核心策略算法

本项目实现了两套基于动量的轮动策略，分别适用于不同的投资场景。

### 1. 止损轮动策略 (Stop Loss Rotation)

该策略在全资产池中进行选品，通过"收益/波动比"因子寻找高性价比资产，并利用相关性矩阵进行分散配置，同时增加止损机制控制风险。

*   **选股因子**: **风险调整后动量 (Risk-Adjusted Momentum)**
    *   公式: $Factor = \frac{Return_{N}}{Volatility_{N}}$
    *   其中 $Return_{N}$ 为过去 N 天的累计收益率, $Volatility_{N}$ 为过去 N 天日收益率的标准差。
*   **相关性过滤 (Correlation Filter)**:
    *   计算过去 K 天的资产日收益率相关性矩阵。
    *   **筛选流程**:
        1.  将所有资产按因子值从高到低排序。
        2.  首选因子最高的资产。
        3.  依次考察后续资产，若其与已选资产的相关系数超过阈值，则跳过。
        4.  直到选满 M 只资产。
*   **权重分配**: 等权重持有入选资产。
*   **止损规则**:
    *   若 T 日某持仓资产跌幅超过止损阈值（默认 6%），则 T+1 日信号中排除该资产。
    *   被止损的资产在当期选股中被排除，由其他符合条件的资产替补。
*   **参数配置**:
    *   `M`: 持有资产数量（默认 3）
    *   `N`: 因子计算窗口（默认 30 天）
    *   `K`: 相关性计算窗口（默认 100 天）
    *   `stop_loss_pct`: 止损阈值（默认 6%）
*   **适用场景**: 适合波动较大的市场环境，通过止损机制控制单资产极端回撤风险。

### 2. 行业轮动策略 (Sector Rotation)

该策略使用独立的行业/主题 ETF 资产池，在更广泛的行业维度上进行轮动配置。

*   **核心逻辑**: 继承止损轮动策略的选股和风控逻辑。
*   **资产池特点**:
    *   **核心宽基**: 沪深300、中证1000、创业板
    *   **跨境资产**: 纳指ETF、印度基金、德国ETF
    *   **防御避险**: 红利ETF、10年国债、银行ETF
    *   **卫星资产**: 豆粕、电网设备、酒ETF、黄金ETF
*   **参数配置**:
    *   `M`: 持有资产数量（默认 3）
    *   `N`: 因子计算窗口（默认 10 天）
    *   `K`: 相关性计算窗口（默认 100 天）
    *   `stop_loss_pct`: 止损阈值（默认 5%）
*   **适用场景**: 适合希望在更多行业/主题间进行配置的投资者。

## 资产池配置

### 默认资产池 (止损轮动)

| 名称 | 代码 | 说明 |
|------|------|------|
| kc50 | 588000 | 科创50 |
| hstech | 513130 | 恒生科技 |
| nasdaq | 513100 | 纳指ETF |
| hs300 | 510300 | 沪深300 |
| nikkei | 513520 | 日经ETF |
| sp500 | 513500 | 标普500 |
| bond30 | 511090 | 30年国债 |
| dividend | 510880 | 红利ETF |
| usdbond | 501300 | 海富通美元债LOF |
| gold | 518880 | 黄金ETF |
| cash | 511990 | 华宝添益 (货币ETF) |

### 行业轮动资产池

| 名称 | 代码 | 说明 |
|------|------|------|
| hs300 | 510300 | 沪深300 |
| zz1000 | 512100 | 中证1000 |
| cyb | 159915 | 创业板 |
| nasdaq | 513100 | 纳指ETF |
| india | 164824 | 印度基金 |
| germany | 513030 | 德国ETF |
| dividend | 510880 | 红利ETF |
| bond_10y | 511260 | 10年国债ETF |
| bank | 512800 | 银行ETF |
| bean | 159985 | 豆粕ETF |
| grid | 159326 | 电网设备 |
| liquor | 512690 | 酒ETF |
| gold | 518880 | 黄金ETF |

## 回测引擎特性

*   **事件驱动**: 模拟真实交易时序，T 日收盘生成信号，T+1 日开盘价成交。
*   **成本模拟**: 包含双边交易佣金（默认万分之三）。
*   **数据对齐**: 自动处理不同市场（A股/港股/美股ETF）的交易日历差异，采用前值填充对齐。
*   **资产贡献分析**: 支持查看各资产对组合收益的贡献明细。

## 快速开始

### 安装依赖

```bash
pip install -r requirements.txt
```

### 交互式菜单系统

推荐使用交互式菜单系统，支持所有策略的回测、优化和实盘建议：

```bash
python main.py
```

### 运行实盘建议

生成次日持仓建议（支持选择策略类型）：

```bash
# 止损轮动策略 (默认)
python -m src.trading_signal

# 行业轮动策略
python -m src.trading_signal --strategy sector_rotation
```

### 运行回测

```bash
python -m src.backtest
```

### 数据更新

数据来源于 `akshare`，运行以下命令获取最新 ETF/LOF 日线数据：

```bash
python -m src.data_loader
```

## 目录结构

```
.
├── main.py                 # 交互式菜单入口
├── src/
│   ├── strategy.py         # 策略核心逻辑 (StopLossRotation, SectorRotation)
│   ├── backtest.py         # 回测引擎 (BacktestEngine)
│   ├── config.py           # 资产代码映射与策略参数配置
│   ├── data_loader.py      # 数据加载与更新
│   ├── trading_signal.py   # 实盘信号生成
│   └── optimize.py         # 参数优化工具
├── data/                   # ETF 日线数据 (CSV)
├── requirements.txt        # Python 依赖
└── README.md
```
