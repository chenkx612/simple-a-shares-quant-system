# Simple A-Shares Quant System

个人量化投资项目，基于 Python 实现的动量轮动策略量化系统。本项目包含**场景轮动**、**智能因子轮动**与**止损轮动**三套核心策略，旨在不同市场环境下捕捉收益并控制回撤。

## 核心策略算法

本项目实现了三套基于动量的轮动策略，分别适用于宏观场景切换、个股/ETF精细化选择以及带风控的轮动配置。

### 1. 场景轮动策略 (Scenario Momentum)

该策略将市场划分为四种宏观情景，根据预设的资产组合在过去 N 天的收益表现进行轮动。

*   **核心逻辑**: 计算四个预设组合过去 N 天（默认 20 天）的累计收益率，每日收盘后选择收益率最高的组合，于次日开盘全仓切换。
*   **组合定义**:
    *   **大涨 (Bull Surge)**: 进攻型组合，由高弹性的科技类资产构成。
        *   配置: 科创50 (30%) + 恒生科技 (30%) + 纳指ETF (40%)
    *   **慢牛 (Slow Bull)**: 平衡型组合，聚焦中美日核心宽基指数。
        *   配置: 沪深300 (40%) + 日经ETF (20%) + 标普500 (40%)
    *   **慢熊 (Slow Bear)**: 防御型组合，配置债券与红利资产。
        *   配置: 30年国债 (30%) + 红利ETF (30%) + 美元债LOF (40%)
    *   **恐慌 (Panic)**: 避险组合。
        *   配置: 黄金ETF (40%) + 货币ETF (60%)

### 2. 智能因子轮动策略 (Smart Factor Rotation)

该策略不依赖预设组合，而是直接在全资产池中进行选品，通过“收益/波动比”因子寻找高性价比资产，并利用相关性矩阵进行分散配置。

*   **选股因子**: **风险调整后动量 (Risk-Adjusted Momentum)**
    *   公式: $Factor = \frac{Return_{N}}{Volatility_{N}}$
    *   其中 $Return_{N}$ 为过去 N 天（默认 30 天）的累计收益率，$Volatility_{N}$ 为过去 N 天日收益率的标准差。
*   **相关性过滤 (Correlation Filter)**:
    *   为了避免持仓过于集中在同一类资产，策略引入相关性控制。
    *   计算过去 K 天（默认 100 天）的资产日收益率相关性矩阵。
    *   **筛选流程**:
        1.  将所有资产按因子值从高到低排序。
        2.  首选因子最高的资产。
        3.  依次考察后续资产，若其与已选资产的相关系数超过阈值（默认 0.9），则跳过。
        4.  直到选满 M 只（默认 3 只）资产。
*   **权重分配**: 等权重持有入选资产。

### 3. 止损轮动策略 (Stop Loss Rotation)

该策略在智能因子轮动的基础上增加了止损机制，当持仓资产单日跌幅超过阈值时，次日开盘自动平仓该资产。

*   **核心逻辑**: 继承智能因子轮动的选股逻辑，同时追踪已选资产的日内表现。
*   **止损规则**:
    *   若 T 日某持仓资产跌幅超过止损阈值（默认 5%），则 T+1 日信号中排除该资产。
    *   被止损的资产在当期选股中被排除，由其他符合条件的资产替补。
*   **参数配置**:
    *   `M`: 持有资产数量（默认 3）
    *   `N`: 因子计算窗口（默认 30 天）
    *   `K`: 相关性计算窗口（默认 100 天）
    *   `stop_loss_pct`: 止损阈值（默认 5%）
*   **适用场景**: 适合波动较大的市场环境，通过止损机制控制单资产极端回撤风险。

## 回测引擎特性

*   **事件驱动**: 模拟真实交易时序，T 日收盘生成信号，T+1 日开盘价成交。
*   **成本模拟**: 包含双边交易佣金（默认万分之三）。
*   **数据对齐**: 自动处理不同市场（A股/港股/美股ETF）的交易日历差异，采用前值填充对齐。

## 快速开始

### 安装依赖

```bash
pip install -r requirements.txt
```

### 交互式菜单系统

推荐使用交互式菜单系统，支持所有策略的回测、优化和实盘建议：

```bash
python main.py
```

### 运行实盘建议

生成次日持仓建议（支持选择策略类型）：

```bash
# 运行场景轮动策略 (默认)
python -m src.trading_signal

# 运行智能因子轮动策略
python -m src.trading_signal --strategy smart_rotation --m 3 --n 30

# 运行止损轮动策略
python -m src.trading_signal --strategy stop_loss_rotation --m 3 --n 30 --stop_loss_pct 0.05
```

### 运行回测

```bash
python -m src.backtest
```

### 数据更新

数据来源于 `akshare`，运行以下命令获取最新 ETF/LOF 日线数据：

```bash
python -m src.data_loader
```

## 目录结构

*   `src/strategy.py`: 策略核心逻辑实现 (`MomentumStrategy`, `SmartRotationStrategy`, `StopLossRotationStrategy`)
*   `src/backtest.py`: 回测引擎 (`BacktestEngine`)
*   `src/config.py`: 资产代码映射与组合配置
*   `src/trading_signal.py`: 实盘信号生成入口
*   `src/optimize.py`: 参数优化工具
